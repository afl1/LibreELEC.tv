commit 4ca74ed47eef746a99bba358a7839c79d11f4647
Author: afl1 <afl2001@gmail.com>
Date:   Sun Jan 20 13:09:34 2019 +0100

    dts: internal dvb driver

diff --git a/arch/arm64/boot/dts/amlogic/Makefile b/arch/arm64/boot/dts/amlogic/Makefile
index a97c0e2d7bc6..de934d915804 100644
--- a/arch/arm64/boot/dts/amlogic/Makefile
+++ b/arch/arm64/boot/dts/amlogic/Makefile
@@ -10,6 +10,8 @@ dtb-$(CONFIG_ARCH_MESON) += meson-gxbb-vega-s95-meta.dtb
 dtb-$(CONFIG_ARCH_MESON) += meson-gxbb-vega-s95-telos.dtb
 dtb-$(CONFIG_ARCH_MESON) += meson-gxbb-wetek-hub.dtb
 dtb-$(CONFIG_ARCH_MESON) += meson-gxbb-wetek-play2.dtb
+dtb-$(CONFIG_ARCH_MESON) += meson-gxbb-ki-plus.dtb
+dtb-$(CONFIG_ARCH_MESON) += meson-gxbb-kii-pro.dtb
 dtb-$(CONFIG_ARCH_MESON) += meson-gxl-s905x-hwacom-amazetv.dtb
 dtb-$(CONFIG_ARCH_MESON) += meson-gxl-s905x-khadas-vim.dtb
 dtb-$(CONFIG_ARCH_MESON) += meson-gxl-s905x-libretech-cc.dtb
@@ -17,6 +19,11 @@ dtb-$(CONFIG_ARCH_MESON) += meson-gxl-s905x-nexbox-a95x.dtb
 dtb-$(CONFIG_ARCH_MESON) += meson-gxl-s905x-p212.dtb
 dtb-$(CONFIG_ARCH_MESON) += meson-gxl-s905d-p230.dtb
 dtb-$(CONFIG_ARCH_MESON) += meson-gxl-s905d-p231.dtb
+dtb-$(CONFIG_ARCH_MESON) += meson-gxl-s905d-ki-pro.dtb
+dtb-$(CONFIG_ARCH_MESON) += meson-gxl-s905d-ki-plus.dtb
+dtb-$(CONFIG_ARCH_MESON) += meson-gxl-s905d-kii-pro.dtb
+dtb-$(CONFIG_ARCH_MESON) += meson-gxl-s905d-m8s-dvb.dtb
+dtb-$(CONFIG_ARCH_MESON) += meson-gxl-s905d-c300-pro.dtb
 dtb-$(CONFIG_ARCH_MESON) += meson-gxl-s805x-p241.dtb
 dtb-$(CONFIG_ARCH_MESON) += meson-gxl-s905w-p281.dtb
 dtb-$(CONFIG_ARCH_MESON) += meson-gxl-s905w-tx3-mini.dtb
diff --git a/arch/arm64/boot/dts/amlogic/meson-gxbb-ki-plus.dts b/arch/arm64/boot/dts/amlogic/meson-gxbb-ki-plus.dts
new file mode 100644
index 000000000000..199ad9318485
--- /dev/null
+++ b/arch/arm64/boot/dts/amlogic/meson-gxbb-ki-plus.dts
@@ -0,0 +1,14 @@
+// SPDX-License-Identifier: (GPL-2.0+ OR MIT)
+/*
+ * Author: afl1 <afl2001@gmail.com>
+ */
+
+#include "meson-gxbb-kii-pro.dts"
+/ {
+	model = "MeCool KI Plus";
+
+	memory@0 {
+		device_type = "memory";
+		reg = <0x0 0x0 0x0 0x40000000>;
+	};
+};
diff --git a/arch/arm64/boot/dts/amlogic/meson-gxbb-kii-pro.dts b/arch/arm64/boot/dts/amlogic/meson-gxbb-kii-pro.dts
new file mode 100644
index 000000000000..b54188bf44a8
--- /dev/null
+++ b/arch/arm64/boot/dts/amlogic/meson-gxbb-kii-pro.dts
@@ -0,0 +1,65 @@
+// SPDX-License-Identifier: (GPL-2.0+ OR MIT)
+/*
+ * Author: afl1 <afl2001@gmail.com>
+ */
+
+#include "meson-gxbb-p201.dts"
+/ {
+	model = "MeCool KII Pro";
+
+	dvb {
+		compatible = "amlogic,dvb";
+		reg = <0x0 0xc1108c40 0x0 0x20>,
+		      <0x0 0xc1105800 0x0 0x3c0>;
+		reg-names = "afifo", "stbtop";
+		dev_name = "avl6862";
+		status = "okay";
+		fec_reset_gpio-gpios0 = <&gpio GPIODV_13 GPIO_ACTIVE_HIGH>;
+		power_ctrl_gpio-gpios0 = <&gpio GPIODV_11 GPIO_ACTIVE_LOW>;
+		//"parallel","serial","disable"
+		ts0 = "parallel";
+		ts0_control = <0>;
+		ts0_invert = <0>;
+		dtv_demod0_i2c_adap_id = <0>;
+		pinctrl-0 = <&dvb_p_ts0_pins>;
+		pinctrl-1 = <&dvb_s_ts0_pins>;
+		pinctrl-names = "p_ts0", "s_ts0";
+		clocks = <&clkc CLKID_DEMUX>,
+			 <&clkc CLKID_ASYNC_FIFO>,
+			 <&clkc CLKID_AHB_ARB0>,
+			 <&clkc CLKID_DOS_PARSER>;
+		clock-names = "demux", "asyncfifo", "ahbarb0", "uparsertop";
+		resets = <&reset RESET_PERIPHS_ASYNC_0>,
+			 <&reset RESET_DEMUX>,
+			 <&reset RESET_DEMUX_RESET_0>;
+		reset-names = "async0", "demux", "demuxreset0";
+		interrupts = <GIC_SPI 23 IRQ_TYPE_EDGE_RISING>,
+			     <GIC_SPI 19 IRQ_TYPE_EDGE_RISING>;
+		interrupt-names = "demux0", "asyncfifo0";
+	};
+};
+
+&periphs {
+	pinctrl_periphs:pinctrl@4b0 {
+		dvb_p_ts0_pins: dvb_p_ts0 {
+			mux {
+				groups = "tsin_a_d_valid", "tsin_a_sop", "tsin_a_clk", "tsin_a_d0", "tsin_a_dp";
+				function = "tsin_a";
+			};
+		};
+		dvb_s_ts0_pins: dvb_s_ts0 {
+			mux {
+				groups = "tsin_a_d_valid", "tsin_a_sop", "tsin_a_clk", "tsin_a_d0"; 
+				function = "tsin_a";
+			};
+		};
+	};
+};
+
+&i2c_A {
+	status = "okay";
+	clock-frequency = <300000>;
+	pinctrl-0 = <&i2c_a_pins>;
+	pinctrl-names = "default";
+};
+
diff --git a/arch/arm64/boot/dts/amlogic/meson-gxbb-wetek-play2.dts b/arch/arm64/boot/dts/amlogic/meson-gxbb-wetek-play2.dts
index 0038522315de..8fa8bddf1099 100644
--- a/arch/arm64/boot/dts/amlogic/meson-gxbb-wetek-play2.dts
+++ b/arch/arm64/boot/dts/amlogic/meson-gxbb-wetek-play2.dts
@@ -8,7 +8,6 @@
 
 #include "meson-gxbb-wetek.dtsi"
 #include <dt-bindings/input/input.h>
-
 / {
 	compatible = "wetek,play2", "amlogic,meson-gxbb";
 	model = "WeTek Play 2";
@@ -39,10 +38,66 @@
 			gpios = <&gpio_ao GPIOAO_3 GPIO_ACTIVE_LOW>;
 		};
 	};
+	clock: meson_clock {
+		compatible = "amlogic, gxbb-clock";
+		reg = <0x0 0xc883c000 0x0 0x1000>,   /* HIU BUS*/
+		          <0x0 0xc8100000 0x0 0x1000>;   //AOBUS
+		#clock-cells = <1>;
+		#reset-cells = <1>;
+		sys_max = <1536000000>;
+	};
+	dvb {
+		compatible = "amlogic,dvb";
+		reg = <0x0 0xc1108c40 0x0 0x20>,
+		      <0x0 0xc1105800 0x0 0x3c0>;
+		reg-names = "afifo", "stbtop";
+		dev_name = "wetek-dvb";
+		status = "okay";
+		fec_reset_gpio-gpios0 = <&gpio GPIOY_13 GPIO_ACTIVE_HIGH>;
+		power_ctrl_gpio-gpios0 = <&gpio GPIOY_15 GPIO_ACTIVE_LOW>;
+		//"parallel","serial","disable"
+		ts0 = "parallel";
+		ts0_control = <0>;
+		ts0_invert = <0>;
+		dtv_demod0_i2c_adap_id = <0>;
+		pinctrl-0 = <&dvb_p_ts0_pins>;
+		pinctrl-1 = <&dvb_s_ts0_pins>;
+		pinctrl-names = "p_ts0", "s_ts0";
+		clocks = <&clkc CLKID_DEMUX>,
+			 <&clkc CLKID_ASYNC_FIFO>,
+			 <&clkc CLKID_AHB_ARB0>,
+			 <&clkc CLKID_DOS_PARSER>;
+		clock-names = "demux", "asyncfifo", "ahbarb0", "uparsertop";
+		resets = <&reset RESET_PERIPHS_ASYNC_0>,
+			 <&reset RESET_DEMUX>,
+			 <&reset RESET_DEMUX_RESET_0>;
+		reset-names = "async0", "demux", "demuxreset0";
+		interrupts = <GIC_SPI 23 IRQ_TYPE_EDGE_RISING>,
+			     <GIC_SPI 19 IRQ_TYPE_EDGE_RISING>;
+		interrupt-names = "demux0", "asyncfifo0";
+	};
+};
+
+&periphs {
+	pinctrl_periphs:pinctrl@4b0 {
+		dvb_p_ts0_pins: dvb_p_ts0 {
+			mux {
+				groups = "tsin_a_d_valid", "tsin_a_sop", "tsin_a_clk", "tsin_a_d0", "tsin_a_dp";
+				function = "tsin_a";
+			};
+		};
+		dvb_s_ts0_pins: dvb_s_ts0 {
+			mux {
+				groups = "tsin_a_d_valid", "tsin_a_sop", "tsin_a_clk", "tsin_a_d0"; 
+				function = "tsin_a";
+			};
+		};
+	};
 };
 
 &i2c_A {
 	status = "okay";
+	clock-frequency = <300000>;
 	pinctrl-0 = <&i2c_a_pins>;
 	pinctrl-names = "default";
 };
@@ -54,3 +109,7 @@
 &usb1 {
 	status = "okay";
 };
+
+&usb_pwr {
+		gpio = <>;
+};
diff --git a/arch/arm64/boot/dts/amlogic/meson-gxl-s905d-c300-pro.dts b/arch/arm64/boot/dts/amlogic/meson-gxl-s905d-c300-pro.dts
new file mode 100644
index 000000000000..c53749969305
--- /dev/null
+++ b/arch/arm64/boot/dts/amlogic/meson-gxl-s905d-c300-pro.dts
@@ -0,0 +1,19 @@
+// SPDX-License-Identifier: (GPL-2.0+ OR MIT)
+/*
+ * Author: afl1 <afl2001@gmail.com>
+ */
+
+#include "meson-gxl-s905d-ki-plus.dts"
+/ {
+	model = "Magicsee C300 PRO DVB-T2/S2/C";
+
+	dvb {
+		dev_name = "avl6762";
+		fec_reset_gpio-gpios0 = <&gpio GPIOZ_2 GPIO_ACTIVE_HIGH>;
+		power_ctrl_gpio-gpios0 = <&gpio_ao GPIOAO_6 GPIO_ACTIVE_LOW>;
+	};
+};
+&i2c_C {
+	status = "okay";
+	clock-frequency = <300000>;
+};
diff --git a/arch/arm64/boot/dts/amlogic/meson-gxl-s905d-ki-plus.dts b/arch/arm64/boot/dts/amlogic/meson-gxl-s905d-ki-plus.dts
new file mode 100644
index 000000000000..aeb2103dad19
--- /dev/null
+++ b/arch/arm64/boot/dts/amlogic/meson-gxl-s905d-ki-plus.dts
@@ -0,0 +1,14 @@
+// SPDX-License-Identifier: (GPL-2.0+ OR MIT)
+/*
+ * Author: afl1 <afl2001@gmail.com>
+ */
+
+#include "meson-gxl-s905d-kii-pro.dts"
+/ {
+	model = "MeCool KI Plus";
+
+	memory@0 {
+		device_type = "memory";
+		reg = <0x0 0x0 0x0 0x40000000>;
+	};
+};
diff --git a/arch/arm64/boot/dts/amlogic/meson-gxl-s905d-ki-pro.dts b/arch/arm64/boot/dts/amlogic/meson-gxl-s905d-ki-pro.dts
new file mode 100644
index 000000000000..2edc2fbec9c9
--- /dev/null
+++ b/arch/arm64/boot/dts/amlogic/meson-gxl-s905d-ki-pro.dts
@@ -0,0 +1,65 @@
+// SPDX-License-Identifier: (GPL-2.0+ OR MIT)
+/*
+ * Author: afl1 <afl2001@gmail.com>
+ */
+
+#include "meson-gxl-s905d-p230.dts"
+/ {
+	model = "MeCool KI Pro (S905D)";
+
+	dvb {
+		compatible = "amlogic,dvb";
+		reg = <0x0 0xc1108c40 0x0 0x20>,
+		      <0x0 0xc1105800 0x0 0x3c0>;
+		reg-names = "afifo", "stbtop";
+		dev_name = "avl6862";
+		status = "okay";
+		fec_reset_gpio-gpios0 = <&gpio GPIODV_13 GPIO_ACTIVE_HIGH>;
+		power_ctrl_gpio-gpios0 = <&gpio GPIODV_11 GPIO_ACTIVE_LOW>;
+		//"parallel","serial","disable"
+		ts0 = "parallel";
+		ts0_control = <0>;
+		ts0_invert = <0>;
+		dtv_demod0_i2c_adap_id = <0>;
+		pinctrl-0 = <&dvb_p_ts0_pins>;
+		pinctrl-1 = <&dvb_s_ts0_pins>;
+		pinctrl-names = "p_ts0", "s_ts0";
+		clocks = <&clkc CLKID_DEMUX>,
+			 <&clkc CLKID_ASYNC_FIFO>,
+			 <&clkc CLKID_AHB_ARB0>,
+			 <&clkc CLKID_DOS_PARSER>;
+		clock-names = "demux", "asyncfifo", "ahbarb0", "uparsertop";
+		resets = <&reset RESET_PERIPHS_ASYNC_0>,
+			 <&reset RESET_DEMUX>,
+			 <&reset RESET_DEMUX_RESET_0>;
+		reset-names = "async0", "demux", "demuxreset0";
+		interrupts = <GIC_SPI 23 IRQ_TYPE_EDGE_RISING>,
+			     <GIC_SPI 19 IRQ_TYPE_EDGE_RISING>;
+		interrupt-names = "demux0", "asyncfifo0";
+	};
+};
+
+&periphs {
+	pinctrl_periphs:pinctrl@4b0 {
+		dvb_p_ts0_pins: dvb_p_ts0 {
+			mux {
+				groups = "tsin_a_d_valid", "tsin_a_sop", "tsin_a_clk", "tsin_a_d0", "tsin_a_dp";
+				function = "tsin_a";
+			};
+		};
+		dvb_s_ts0_pins: dvb_s_ts0 {
+			mux {
+				groups = "tsin_a_d_valid", "tsin_a_sop", "tsin_a_clk", "tsin_a_d0"; 
+				function = "tsin_a";
+			};
+		};
+	};
+};
+
+&i2c_B {
+	status = "okay";
+	clock-frequency = <300000>;
+	pinctrl-0 = <&i2c_b_pins>;
+	pinctrl-names = "default";
+};
+
diff --git a/arch/arm64/boot/dts/amlogic/meson-gxl-s905d-kii-pro.dts b/arch/arm64/boot/dts/amlogic/meson-gxl-s905d-kii-pro.dts
new file mode 100644
index 000000000000..74a19fb8f4bd
--- /dev/null
+++ b/arch/arm64/boot/dts/amlogic/meson-gxl-s905d-kii-pro.dts
@@ -0,0 +1,64 @@
+// SPDX-License-Identifier: (GPL-2.0+ OR MIT)
+/*
+ * Author: afl1 <afl2001@gmail.com>
+ */
+
+#include "meson-gxl-s905d-p231.dts"
+/ {
+	model = "MeCool KII Pro (S905D)";
+
+	dvb {
+		compatible = "amlogic,dvb";
+		reg = <0x0 0xc1108c40 0x0 0x20>,
+		      <0x0 0xc1105800 0x0 0x3c0>;
+		reg-names = "afifo", "stbtop";
+		dev_name = "avl6862";
+		status = "okay";
+		fec_reset_gpio-gpios0 = <&gpio GPIODV_13 GPIO_ACTIVE_HIGH>;
+		power_ctrl_gpio-gpios0 = <&gpio GPIODV_11 GPIO_ACTIVE_LOW>;
+		//"parallel","serial","disable"
+		ts0 = "parallel";
+		ts0_control = <0>;
+		ts0_invert = <0>;
+		dtv_demod0_i2c_adap_id = <0>;
+		pinctrl-0 = <&dvb_p_ts0_pins>;
+		pinctrl-1 = <&dvb_s_ts0_pins>;
+		pinctrl-names = "p_ts0", "s_ts0";
+		clocks = <&clkc CLKID_DEMUX>,
+			 <&clkc CLKID_ASYNC_FIFO>,
+			 <&clkc CLKID_AHB_ARB0>,
+			 <&clkc CLKID_DOS_PARSER>;
+		clock-names = "demux", "asyncfifo", "ahbarb0", "uparsertop";
+		resets = <&reset RESET_PERIPHS_ASYNC_0>,
+			 <&reset RESET_DEMUX>,
+			 <&reset RESET_DEMUX_RESET_0>;
+		reset-names = "async0", "demux", "demuxreset0";
+		interrupts = <GIC_SPI 23 IRQ_TYPE_EDGE_RISING>,
+			     <GIC_SPI 19 IRQ_TYPE_EDGE_RISING>;
+		interrupt-names = "demux0", "asyncfifo0";
+	};
+};
+
+&periphs {
+	pinctrl_periphs:pinctrl@4b0 {
+		dvb_p_ts0_pins: dvb_p_ts0 {
+			mux {
+				groups = "tsin_a_d_valid", "tsin_a_sop", "tsin_a_clk", "tsin_a_d0", "tsin_a_dp";
+				function = "tsin_a";
+			};
+		};
+		dvb_s_ts0_pins: dvb_s_ts0 {
+			mux {
+				groups = "tsin_a_d_valid", "tsin_a_sop", "tsin_a_clk", "tsin_a_d0"; 
+				function = "tsin_a";
+			};
+		};
+	};
+};
+
+&i2c_B {
+	status = "okay";
+	clock-frequency = <300000>;
+	pinctrl-0 = <&i2c_b_pins>;
+	pinctrl-names = "default";
+};
diff --git a/arch/arm64/boot/dts/amlogic/meson-gxl-s905d-m8s-dvb.dts b/arch/arm64/boot/dts/amlogic/meson-gxl-s905d-m8s-dvb.dts
new file mode 100644
index 000000000000..cf0455cf6e61
--- /dev/null
+++ b/arch/arm64/boot/dts/amlogic/meson-gxl-s905d-m8s-dvb.dts
@@ -0,0 +1,13 @@
+// SPDX-License-Identifier: (GPL-2.0+ OR MIT)
+/*
+ * Author: afl1 <afl2001@gmail.com>
+ */
+
+#include "meson-gxl-s905d-ki-plus.dts"
+/ {
+	model = "MeCool M8S Plus DVB-T2/T";
+
+	dvb {
+		dev_name = "avl6762";
+	};
+};
diff --git a/arch/arm64/boot/dts/amlogic/meson-gxm-khadas-vim2.dts b/arch/arm64/boot/dts/amlogic/meson-gxm-khadas-vim2.dts
index 313f88f8759e..139e0fefcf7a 100644
--- a/arch/arm64/boot/dts/amlogic/meson-gxm-khadas-vim2.dts
+++ b/arch/arm64/boot/dts/amlogic/meson-gxm-khadas-vim2.dts
@@ -196,6 +196,58 @@
 		clock-frequency = <32768>;
 		pwms = <&pwm_ef 0 30518 0>; /* PWM_E at 32.768KHz */
 	};
+	dvb {
+		compatible = "amlogic,dvb";
+		reg = <0x0 0xc1108c40 0x0 0x20>,
+		      <0x0 0xc1105800 0x0 0x3c0>;
+		reg-names = "afifo", "stbtop";
+		dev_name = "avl6862";
+		status = "okay";
+		fec_reset_gpio-gpios0 = <&gpio GPIODV_12 GPIO_ACTIVE_HIGH>;
+		power_ctrl_gpio-gpios0 = <&gpio GPIODV_20 GPIO_ACTIVE_LOW>;
+		lock_led_gpio-gpios0 = <&gpio GPIODV_11 GPIO_ACTIVE_HIGH>;
+		//"parallel","serial","disable"
+		ts0 = "serial";
+		ts0_control = <0>;
+		ts0_invert = <0>;
+		dtv_demod0_i2c_adap_id = <0>;
+		pinctrl-0 = <&dvb_s_ts0_pins>;
+		pinctrl-1 = <&dvb_s_ts1_pins>;
+		pinctrl-names = "s_ts0", "s_ts1";
+		clocks = <&clkc CLKID_DEMUX>,
+			 <&clkc CLKID_ASYNC_FIFO>,
+			 <&clkc CLKID_AHB_ARB0>,
+			 <&clkc CLKID_DOS_PARSER>;
+		clock-names = "demux", "asyncfifo", "ahbarb0", "uparsertop";
+		resets = <&reset RESET_PERIPHS_ASYNC_0>,
+			<&reset RESET_PERIPHS_ASYNC_1>,
+			 <&reset RESET_DEMUX>,
+			 <&reset RESET_DEMUX_RESET_0>,
+			 <&reset RESET_DEMUX_RESET_1>;
+		reset-names = "async0", "async1", "demux", "demuxreset0", "demuxreset1";
+		interrupts = <GIC_SPI 23 IRQ_TYPE_EDGE_RISING>,
+			     <GIC_SPI 53 IRQ_TYPE_EDGE_RISING>,
+			     <GIC_SPI 19 IRQ_TYPE_EDGE_RISING>,
+			     <GIC_SPI 25 IRQ_TYPE_EDGE_RISING>;
+		interrupt-names = "demux0", "demux1", "asyncfifo0", "asyncfifo1";
+	};
+};
+
+&periphs {
+	pinctrl_periphs:pinctrl@4b0 {
+		dvb_s_ts0_pins: dvb_s_ts0 {
+			mux {
+				groups = "tsin_a_d_valid", "tsin_a_sop", "tsin_a_clk", "tsin_a_d0";
+				function = "tsin_a";
+			};
+		};
+		dvb_s_ts1_pins: dvb_s_ts1 {
+			mux {
+				groups = "tsin_b_d_valid", "tsin_b_sop", "tsin_b_clk", "tsin_b_d0";
+				function = "tsin_b";
+			};
+		};
+	};
 };
 
 &cec_AO {
@@ -289,6 +341,7 @@
 	status = "okay";
 	pinctrl-0 = <&i2c_b_pins>;
 	pinctrl-names = "default";
+	clock-frequency = <300000>;
 
 	rtc: rtc@51 {
 		/* has to be enabled manually when a battery is connected: */
